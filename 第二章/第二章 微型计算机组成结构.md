# 第二章 微型计算机组成结构
## 2.1  微型计算机组成原理
	
- 80386内部地址线有32根，即寻址空间有0~4G。
- 图中上方的是以集成电路芯片为主组成的功能电路，集成在主电路板上。图中下方的控制卡（适配器）是通过扩展插槽与主板上系统总线连接。这些总线接口有统一的标准，而80386只有ISA总线，因此系统与外部I/O设备最多只能使用__16位__数据进行数据传输。

![](https://raw.githubusercontent.com/HJDonv/linux-kernel-0.11/master/%E7%AC%AC%E4%BA%8C%E7%AB%A0/picture/1.png)

## 2.2  I/O寻址和控制访问方式
- CPU访问I/O接口控制器或者控制卡需要地址，这种地址成为__端口__。
- 端口地址的设置方法有两种：独立编址和统一编址。
>1.独立编址(专用的I/O端口编址)----存储器和I/O端口在两个独立的地址空间中。  
>(1)优点：I/O端口的地址码较短，译码电路简单，存储器同I/O端口的操作指令不同，程序比较清晰；存储器和I/O端口的控制结构相互独立，可以分别设计。  
>(2)缺点：需要有专用的I/O指令，程序设计的灵活性较差。

>2.统一编址(存储器映像编址)----存储器和I/O端口共用统一的地址空间，当一个地址空间分配给I/O端口以后，存储器就不能再占有这一部分的地址空间。  
>(1)优点：不需要专用的I/O指令，任何对存储器数据进行操作的指令都可用于I/O端口的数据操作，程序设计比较灵活；由于I/O端口的地址空间是内存空间的一部分，这样，I/O端口的地址空间可大可小，从而使外设的数量几乎不受限制。  
>(2)缺点：I/O端口占用了内存空间的一部分，影响了系统的内存容量；访问I/O端口也要同访问内存一样，由于内存地址较长，导致执行时间增加。

- 数据传输的方式：轮询、中断、DMA
## 2.3  主存储器、BIOS和CMOS存储器
### 2.3.1  主存储器
- 因为在**以前的PC**
只有20根地址线，所以最大内存寻址空间址只有1M，虽然**现在的PC**
内存多了很多，可是为了兼容，1M以下物理内存的使用分配仍然和**以前的PC**
一样。不过**现在的PC**
把BIOS放到了内存最高处，**以前的PC**
放BIOS的内存地址变成了BIOS的映射，就是**现在的PC**的BIOS还是会复制到这个区域中。
- 除了640k-1M和4G最后64k的范围，其他都可以作为系统内存。这两个范围用于I/O设备和BIOS程序。
>如果现在有一台16M内存的机器，要装linux0.1x系统，由于linux内核不使用BIOS的功能也不使用BIOS设置的中断向量，所以0~640K被用来存内核代码和数据，640k~1M保留原来的功能。
![](https://raw.githubusercontent.com/HJDonv/linux-kernel-0.11/master/%E7%AC%AC%E4%BA%8C%E7%AB%A0/picture/2.png)
### 2.3.2 基本输入/输出程序BIOS
- 开机时候需要用到BIOS,进入linux后不用BIOS。
> 现在的电脑，按了开机键后，CPU跳到内存最后那64K去执行ROM BIOS，在BIOS中初始化一些硬件和检测操作之后，就会把这64K的代码复制到与以前PC兼容的1M末端那里，然后跳到那个地方去继续工作。最后BIOS会从硬盘或其他块设备把操作系统引导程序（boot）加到内存__0x7c00__
>，并跳到这个地址去执行。
### 2.3.3 CMOS存储器
- 除了ROM BIOS和内存外，还需要一些CMOS存储器来存类似实时时钟和系统硬件配置等信息。
- CMOS内存地址空间在基本内存空间之外，需要I/O指令来访问。
>我觉得这个应该是独立编址，PC提供一个接口给CMOS存储器，通过串行通信或者并行通信什么的来捣鼓这个存储器里面的数据，就是PC和存储器之间有一定的协议。
## 2.4  控制器和控制卡
### 2.4.1 中断控制器
- 一开始BIOS会设置对应的可编程中断芯片，建立中断向量表上面的，不过linux在内核初始化的时候又重新设置了一遍。具体要看后面章节才知道
### 2.4.2 DMA控制器
- 软盘控制器被专门指定使用DMA通道2
- 用DMA前配置，涉及三个端口操作：页面寄存器端口、（偏移）地址寄存器端口、数据计数寄存器端口。
- 由于DMA寄存器是8位的，而地址和计数值是16位，因此各自需要发送2次。
### 2.4.3 定时器
- __linux0.11对通道0进行重定义，每隔10ms产生一个中断请求(IRQ0)，作为内核工作脉搏。__
### 2.4.7 软盘和硬盘控制器
- 对磁盘控制器的编程就是通过I/O端口设置控制器中寄存器的相关内容，让控制器去读写磁盘。
- 软盘控制器控制信号用I/O端口，数据传输采用DMA。
- AT硬盘采用高速数据块进行传输，不用DMA。
> CPU->磁盘控制器->驱动器->磁盘
![](https://raw.githubusercontent.com/HJDonv/linux-kernel-0.11/master/%E7%AC%AC%E4%BA%8C%E7%AB%A0/picture/3.png)
## 2.5  自己的总结
- 了解80386的硬件基础，看多几遍看多几遍，留个印象，都很重要。